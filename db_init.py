import asyncio
import sys
# –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ app –∏ core —è–≤–ª—è—é—Ç—Å—è –ø–∞–∫–µ—Ç–∞–º–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
try:
    from app.core.database import init_db
    from app.core.config import settings
except ImportError as e:
    print(f"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ app.core.database –∏ app.core.config –¥–æ—Å—Ç—É–ø–Ω—ã.")
    sys.exit(1)

async def main():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–¥–∏–Ω —Ä–∞–∑."""
    print(f"--- üöÄ –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –ø–æ –∞–¥—Ä–µ—Å—É: {settings.DATABASE_URL} ---")
    try:
        await init_db()
        print("--- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (Base.metadata.create_all) –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. ---")
    except Exception as e:
        print(f"--- ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e} ---")
        # –î–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º—ã –º–æ–∂–µ–º –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É.
        # –ü–æ—Å–∫–æ–ª—å–∫—É –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ create_all() –±–µ–∑ checkfirst=True, –º—ã –¥–æ–ª–∂–Ω—ã 
        # –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏ DuplicateTableError –∏ IntegrityError (UniqueViolationError),
        # –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º —Ç–æ–≥–æ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –£–ñ–ï —Å–æ–∑–¥–∞–Ω–∞.
        if "DuplicateTableError" in str(e) or "UniqueViolationError" in str(e):
             print("--- ‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–∞. ---")
             sys.exit(0) # –£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥, —á—Ç–æ–±—ã start.sh –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–±–æ—Ç—É
        
        sys.exit(1) # –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞

if __name__ == "__main__":
    asyncio.run(main())